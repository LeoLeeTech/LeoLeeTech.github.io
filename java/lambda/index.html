<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>我眼中的Java函数式编程(教程向) | 李吉磊 Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.5fb9499f.js" as="script"><link rel="preload" href="/assets/js/2.9b59b4ff.js" as="script"><link rel="preload" href="/assets/js/1.96620eb7.js" as="script"><link rel="preload" href="/assets/js/29.66073005.js" as="script"><link rel="prefetch" href="/assets/js/10.619c73b1.js"><link rel="prefetch" href="/assets/js/11.4fe3d8ed.js"><link rel="prefetch" href="/assets/js/12.431e0208.js"><link rel="prefetch" href="/assets/js/13.bbe468eb.js"><link rel="prefetch" href="/assets/js/14.12dedade.js"><link rel="prefetch" href="/assets/js/15.ce4589f9.js"><link rel="prefetch" href="/assets/js/16.f10ed1ca.js"><link rel="prefetch" href="/assets/js/17.9003e5f4.js"><link rel="prefetch" href="/assets/js/18.6a5c6852.js"><link rel="prefetch" href="/assets/js/19.4b690de6.js"><link rel="prefetch" href="/assets/js/20.3bada28f.js"><link rel="prefetch" href="/assets/js/21.21d2fb09.js"><link rel="prefetch" href="/assets/js/22.faf845ed.js"><link rel="prefetch" href="/assets/js/23.b8ebfab3.js"><link rel="prefetch" href="/assets/js/24.b27a1f24.js"><link rel="prefetch" href="/assets/js/25.24f97634.js"><link rel="prefetch" href="/assets/js/26.e2c8f48f.js"><link rel="prefetch" href="/assets/js/27.9f133172.js"><link rel="prefetch" href="/assets/js/28.75ed8791.js"><link rel="prefetch" href="/assets/js/3.c5ac82c9.js"><link rel="prefetch" href="/assets/js/30.a2505f42.js"><link rel="prefetch" href="/assets/js/4.2252019f.js"><link rel="prefetch" href="/assets/js/5.9c2dcfae.js"><link rel="prefetch" href="/assets/js/6.e16cc827.js"><link rel="prefetch" href="/assets/js/7.d07accda.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.58186997.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">李吉磊 Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/lijileiGood/lijileiGood.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/lijileiGood/lijileiGood.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>我眼中的Java函数式编程(教程向)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/lambda/#lambda" class="sidebar-link">lambda</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/lambda/#函数式接口" class="sidebar-link">函数式接口</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/lambda/#stream" class="sidebar-link">Stream</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/lambda/#中间操作" class="sidebar-link">中间操作</a></li><li class="sidebar-sub-header"><a href="/java/lambda/#终端操作" class="sidebar-link">终端操作</a></li></ul></li><li><a href="/java/lambda/#optional" class="sidebar-link">Optional</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/lambda/#创建empty-of-ofnullable" class="sidebar-link">创建empty/of/ofNullable</a></li><li class="sidebar-sub-header"><a href="/java/lambda/#过程" class="sidebar-link">过程</a></li><li class="sidebar-sub-header"><a href="/java/lambda/#结束" class="sidebar-link">结束</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>函数式编程（Functional Programming）是把函数作为基本运算单元，函数可以作为变量，可以接收函数，还可以返回函数</p> <ol><li>简化代码：使用 Lambda 表达式/函数式接口/方法引用可以大大减少代码量和模板代码</li> <li>更灵活：函数式编程的设计思想与设计模式类似，更关注接口设计和抽象，而不是细节实现，这样可以让代码更加灵活和可扩展。</li> <li>更易测试：函数式编程的代码具有良好的单元测试能力，因为它关注于输入和输出之间的映射关系，并且不会与外部状态产生关联。</li></ol> <h2 id="lambda"><a href="#lambda" class="header-anchor">#</a> lambda</h2> <p>Lambda 表达式，也叫闭包(js中的一个概念)，新特性：可以把函数(方法)当做一个参数传入方法并使用。<br>
格式同js的箭头函数一样<br>
参数和返回值均可由编译器自动推断</p> <p><strong>@FunctionalInterface</strong><br>
只有一个抽象方法的接口就可以作为lambda表达式用的接口<br>
加上此注解就像@Override一样，不加也能用，加上就是接口出现两个抽象方法时就会报错。jdk中的所有相同作用的接口都加上了该注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">interface</span> <span class="token class-name">NumberInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tester</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 正常subtraction变量需要用一个Interface的实现类赋值给它才行</span>
     <span class="token comment">// () -&gt; 这一部分叫做lambda表达式，jdk8的变化就是可以不用实现类了(or 匿名内部类)，直接写的就是【入参 -&gt; 方法体】部分，这样代码相对于以前就非常简洁了</span>
     <span class="token comment">// 好处：少写了一个实现类</span>
      <span class="token class-name">NumberInterface</span> subtraction <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
  		<span class="token comment">// 就是正常的new 对象，调方法</span>
      <span class="token class-name">Tester</span> tester <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tester</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;10 - 5 = &quot;</span> <span class="token operator">+</span> tester<span class="token punctuation">.</span><span class="token function">operate</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> subtraction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// 这个方法和正常的一样，第三个参数是接口，面向接口开发</span>
   <span class="token comment">// 不过实际的入参是lambda表达式进来</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token class-name">NumberInterface</span> numberInterface<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> numberInterface<span class="token punctuation">.</span><span class="token function">operate</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>真实代码</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 这是jdk中开启新线程的一个接口</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 这是匿名内部类(接口)的写法，想较于以前需要写一个新类并 extends Thread，再放进来已经算是简洁了</span>
    <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;新线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这是lambda写法，没有参数，直接写方法体</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;新线程&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>真实代码2</strong><br>
这是项目中封装的redis锁框架</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 函数式接口 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DoInterface</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>    
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 框架中：用函数式接口的地方 <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
		<span class="token comment">/**
     * 获取一把锁，执行function，释放锁
     *
     * @param lockKey  锁的key
     * @param function 执行方法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">lockDo</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token class-name">DoInterface</span> function<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 传进来是个lambda表达式，在这里面就直接.execute()就是调用啦</span>
        function<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> 业务代码中：<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
        <span class="token class-name">RedisLock</span><span class="token punctuation">.</span><span class="token function">lockDo</span><span class="token punctuation">(</span><span class="token string">&quot;keyXxxxx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            			<span class="token comment">// 锁上之后需要执行的逻辑</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>方法引用</strong></p> <p>两类方法：<br>
静态方法<br>
实例方法(对象调的方法)：调用时总是有一个隐含参数this, 第一个参数：this</p> <p>所谓方法引用，是指如果某个方法签名和接口恰好一致，就可以直接传入方法引用。就是避免写重复代码<br>
方法引用，顾名思义，引用某个已经存在的方法</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;Apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Banana&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Lemon&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 以前的写法</span>
      	<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
        <span class="token comment">// 简化成lambda表达式写法，</span>
        <span class="token comment">// 要一个入参：两个字符串；方法体：xx.compareTo(xx); 返回值：int</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> o1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>接口中定义的方法是<span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span>
      静态方法<span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">)</span> 也是这样
      两者方法签名一样，方法参数一致，返回类型相同
      <span class="token comment">// 这种情况下可以用方法引用，即引用一个已经存在的方法</span>
        <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token class-name">Main</span><span class="token operator">::</span><span class="token function">cmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// 这样也行。因为String的该方法，有一个隐含的this参数，也就相当于有两个参数了，相当于public static int compareTo(String this, String o);</span>
      <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">::</span><span class="token function">compareTo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>构造方法的方法引用</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token class-name">R</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Function&lt;T, R&gt;</code> 是一个在JDK8引入的函数式接口(里面只有一个抽象方法)，其中T代表形参类型， R代表返回类型。这种函数式接口通常用于需要进行数据转换的场合，例如对列表中每个元素进行操作，并将结果存储在另一个列表中。</p> <p>**巧了，一个参数的构造方法就符合这个接口！**传入参数<code>String</code>，返回类型<code>Person</code>。构造方法虽然没有<code>return</code>语句，但它会隐式地返回<code>this</code>实例，构造方法的引用写法是<code>类名::new</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> names
          										<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          										<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span>
					          					<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>方法引用就四种情况</p> <ol><li><p>对象 :: 实例方法</p></li> <li><p>类名 :: 静态方法</p></li> <li><p>类名 :: 实例方法</p></li> <li><p>构造器引用</p></li></ol> <h2 id="函数式接口"><a href="#函数式接口" class="header-anchor">#</a> 函数式接口</h2> <p><strong>Consumer&lt;T&gt;</strong> 代表了接受一个输入参数并且无返回的操作</p> <p><strong>Function&lt;T,R&gt;</strong>  接受一个输入参数，返回一个结果。</p> <p><strong>Supplier&lt;T&gt;</strong>  无参数，返回一个结果。</p> <p><strong>Predicate&lt;T&gt;</strong> 接受一个输入参数，返回一个布尔值结果。</p> <h2 id="stream"><a href="#stream" class="header-anchor">#</a> Stream</h2> <p>&lt;img src=&quot;./images/wps12.jpg&quot; alt=&quot;img&quot; style=&quot;zoom: 50%;&quot; /&gt;</p> <p>数组使用 <code>Arrays.stream()</code> 或 <code>Stream.of()</code>创建流。Stream.of里面也是调的Arrays.stream().<br>
集合使用 <code>list.stream()</code> 方法创建流，因为该方法已经添加到 Collection 接口（单列集合）中</p> <div class="language-java extra-class"><pre class="language-java"><code># <span class="token class-name">Collection</span>接口源码
<span class="token comment">// 返回值是一个Stream的流</span>
<span class="token keyword">default</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token class-name">StreamSupport</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token function">spliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 默认是：8核CPU生成7个线程，因为会有一个主线程控制着其他7个</span>
<span class="token keyword">default</span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> <span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token class-name">StreamSupport</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token function">spliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;武汉&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;中国&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;世界&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>

stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;武汉&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;中国&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;武汉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;中国&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有序流</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> myStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 并行流（无序流），多线程操作，效率更高</span>
myStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有序 -&gt; 无序</span>
有序流<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="中间操作"><a href="#中间操作" class="header-anchor">#</a> 中间操作</h3> <p>执行中间操作就像是给这个水管换了另一个型号的接头，这之后你再去操作原stream都会报错</p> <p><strong>filter</strong><br> <code>filter()</code>中接收的是一个 Predicate（函数式接口，接受一个参数返回一个布尔值）类型的参数</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> filterStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> str<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;中国&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>map映射</strong><br> <code>map()</code> 中接收的是一个 Function（函数式接口，接受一个参数T，返回一个结果 ）类型的参数，此时参数 为 String 类的 length 方法，也就是把 <code>Stream&lt;String&gt;</code> 的流转成一个 <code>Stream&lt;Integer&gt;</code> 的流</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 映射成新的类型的流</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> bigDecimalStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方法引用的写法</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> bigDecimalStream <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="终端操作"><a href="#终端操作" class="header-anchor">#</a> 终端操作</h3> <p>终端操作，被消费后则这个filterStream流就不能再被任何形式的使用</p> <p><strong>forEach()</strong><br> <code>forEach()</code> 接收的是一个 Consumer（函数式接口，接受一个参数, 无返回值）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 打印到控制台</span>
stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方法引用版</span>
stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>collect()转换容器</strong><br>
collect()出来的新集合流是新建的，和原来集合一点关系没有</p> <p>collect()中接收的是Collector接口，但该接口不是函数式接口，里面有很多方法<br>
Collectors实现的上方接口，他是一个收集器的工具类，内置了一系列收集器实现</p> <blockquote><p><code>toList()</code> 将元素收集到新的 <code>java.util.List</code> 中<br>
toSet()<br>
toMap()<br> <code>joining()</code> 将元素收集到一个分隔符分隔的字符串</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 转list</span>
stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 转map</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Dto</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> <span class="token class-name">Dto</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaobaoPersonDto</span><span class="token punctuation">&gt;</span></span> baseList <span class="token operator">=</span> <span class="token function">pageSearch</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">TaobaoPersonDto</span><span class="token punctuation">&gt;</span></span> accountBaseMap <span class="token operator">=</span> baseList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">TaobaoPersonDto</span><span class="token operator">::</span><span class="token function">getAccount</span><span class="token punctuation">,</span> dto <span class="token operator">-&gt;</span> dto<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 转字符串 [周杰伦, 王力宏, 陶喆] -&gt; 周杰伦, 王力宏, 陶喆</span>
<span class="token class-name">String</span> str <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 分组</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
  <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>
				<span class="token class-name">Dto</span><span class="token operator">::</span><span class="token function">getReadType</span><span class="token punctuation">,</span>
        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="分组groupingby"><a href="#分组groupingby" class="header-anchor">#</a> 分组groupingBy</h4> <p>该条是上面collect(Collectors.groupingBy())的详细解释<br>
见名知意，对应的是sql中的group by操作，对结果进行分组</p> <p><strong>接收一个参数</strong><br>
函数式接口，传lambda表达式进来<br>
返回map，<strong>map的key为分组的值，value为list(分好的数据集)</strong></p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// 没看懂返回值~</span>
<span class="token comment">// 最后调调调调就调到三个参数的那个方法中了</span>
public <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> classifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">groupingBy</span><span class="token punctuation">(</span>classifier<span class="token punctuation">,</span> <span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 简单类型, 根据奇偶分组</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> intList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> intList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
  			<span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> e<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 按对象中的某一个属性分组</span>
<span class="token comment">// User::getEducation  等同lambda表达式e -&gt; e.getEduction()</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
  			<span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 按对象的多个属性分组，嵌套分组 (groupingBy 接收两个参数), map下面包map</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
  <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getAge</span><span class="token punctuation">,</span> 
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getEducation</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 按整个对象分组, 对象相同的放一组</span>
<span class="token comment">// 调用构造方法，并用hashcode和equals方法来判断对象是否相等</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
  <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>接收两个参数 -&gt; 对结果集进行处理</strong></p> <div class="language-dart extra-class"><pre class="language-dart"><code>public <span class="token keyword">static</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> classifier<span class="token punctuation">,</span>
                                      <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token punctuation">&gt;</span></span> downstream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">groupingBy</span><span class="token punctuation">(</span>classifier<span class="token punctuation">,</span> <span class="token class-name">HashMap</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">,</span> downstream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 计算平均值, score相同的人的平均年龄</span>
<span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token operator">&gt;</span> collect <span class="token operator">=</span> <span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
     <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>
       	<span class="token class-name">User</span><span class="token punctuation">::</span>getScore<span class="token punctuation">,</span> 
        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">averagingInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">::</span>getAge<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// count，score相同的总共有多少人</span>
<span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">&gt;</span> collect <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
                  <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>
                    	<span class="token class-name">User</span><span class="token punctuation">::</span>getScore<span class="token punctuation">,</span> 
                      <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 求和， score相同的年龄加起来得是多少</span>
<span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token operator">&gt;</span> collect <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
          <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>
            <span class="token class-name">User</span><span class="token punctuation">::</span>getScore<span class="token punctuation">,</span> 
            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">summingInt</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">::</span>getAge<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>接收三个参数</strong><br>
指定生成的map用那个实现类，默认是HashMap, 可以改成treeMap之类的</p> <h2 id="optional"><a href="#optional" class="header-anchor">#</a> Optional</h2> <p><strong>前人经验</strong></p> <p>如果你依赖 isPresent 和 get，那和传统的 != null 没区别<br>
真正有用的是 ifPresent, ifPresentOrElse, orElseGet 等的函数式方法</p> <p><strong>简介</strong></p> <p>解决NPE问题，主要是减少<code>if(xxx != null)</code>防御性代码</p> <p>Optional类不能作为最终结果输出出去，比如说打印、落库之类的。也和stream流一样分为中间操作和最终操作，中间操作都会在外面包裹着Optional一层，最终操作才能拿到真实结果</p> <p>谨慎使用isPresent()和get()方法，尽量多使用map()、filter()、orElse()等方法</p> <p><strong>rust编程语言不存在空指针异常吗？</strong></p> <p>Rust 本质上是允许存在空指针（null pointer）的，该语言在类型系统中引入了一种特殊的类型 Option&lt;T&gt;，它既可以代表某个值，也可以代表空值（Null）。 Option&lt;T&gt; 类型可以防止开发人员调用 null 指针，也就是避免了空指针异常。</p> <p><strong>为什么rust适合用于操作系统内核编写？</strong></p> <ol><li>内存安全：Rust 的所有权系统可以防止在运行时出现内存错误，如空指针和缓冲区溢出。内核更不能出现这种错误</li> <li>超低级别控制：提供了 C 语言级别的控制力，使得开发人员可以像使用 C 语言一样操作底层硬件和操作系统。同时Rust 的类型系统，可以防止在过程中出现常见的 C 语言错误</li> <li>高性能：还可以生成非常高效的机器码。</li></ol> <p>综上所述，Rust 语言提供了内存安全、高效率和C语言级别的控制权力，这都是很适合于编写操作系统内核</p> <p><strong>java中的optional&lt;&gt;方式，需要所有可能出现空指针的地方吗</strong></p> <p>Rust 的所有权模型和借用机制可以在编译时防止 null 指针引用的出现，而 Java 在这方面则相对薄弱。Java 的 Optional&lt;T&gt; 类型仅是一种编程习惯和标准实践，它并不能完全避免空指针异常的发生。</p> <p>因此，在 Java 中为了避免出现空指针异常，需要在所有可能为空的地方使用 Optional&lt;T&gt;，或者显式地检查变量是否为 null。这需要在编程时非常谨慎，并花费更多的时间和精力。</p> <p>综上所述，虽然 Java 在防止空指针异常方面引入了 Optional&lt;T&gt; 类型，但是它并不能像 Rust 一样在编译时避免空指针的出现。</p> <h3 id="创建empty-of-ofnullable"><a href="#创建empty-of-ofnullable" class="header-anchor">#</a> 创建empty/of/ofNullable</h3> <p>Optional的构造方法是private的，所以不能new, 只能用它提供的三个静态方法来创建Optinal对象</p> <ul><li>empty()   创建一个为空的Optional对象</li> <li>of(T value)  创建一个**一定非null的Optional对象</li> <li>ofNullable(T value) 创建一个<strong>可能为null</strong>的Optional对象, is null -&gt; set empty()</li></ul> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token comment">// 1、创建一个为空的Optional对象</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> optStr <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2、创建一个一定非空的Optional对象</span>
<span class="token comment">// 传进去的值一定不能为null。传过去null,编译不报错，但运行会抛NullPointException</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> optStr1 <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;optional&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 源码，即new了Optional一个对象，直接把值放进去了</span>
public <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token comment">// 3、创建一个可能为null的Optional对象</span>
<span class="token comment">// 传进去的值可以为null, 为null时则自动给赋上Optional.empty。</span>
<span class="token comment">// 为null时打印： 打印该对象：Optional.empty。</span>
<span class="token comment">// 不为null时打印：Optional[字符串]</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> optStr2 <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 源码：三元运算符，为null时则给他一个empty</span>
 public <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 学生不为null,则返回性别。</span>

<span class="token comment">// not use Optional</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">String</span> <span class="token function">getGender</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 防御性检查</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> student<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Unkown&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> student<span class="token punctuation">.</span><span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Optional方式</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">String</span> <span class="token function">getGender</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getGender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">&quot;Unkown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre></div><h3 id="过程"><a href="#过程" class="header-anchor">#</a> 过程</h3> <h4 id="ispresent"><a href="#ispresent" class="header-anchor">#</a> <strong>isPresent()</strong></h4> <p>是否不为null</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 源码：简单的一个非null判断，就是个带名字的工具类</span>
<span class="token keyword">public</span> <span class="token return-type class-name">boolean</span> <span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">value</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实际使用，最后来这么一个方法，不过是判断是不是为null判断</span>
 <span class="token class-name">boolean</span> flag <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ifpresent"><a href="#ifpresent" class="header-anchor">#</a> <strong>ifPresent()</strong></h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 源码：不为null则执行该方法</span>
<span class="token comment">// Consumer: 一个参数，但无返回值 </span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">Consumer<span class="token punctuation">&lt;</span><span class="token punctuation">?</span> super T<span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打印学生姓名，由于ifPresent()方法内部做了null值检查，调用前无需担心NPE问题。</span>
Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span>  System<span class="token punctuation">.</span><span class="token keyword">out</span><span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="filter"><a href="#filter" class="header-anchor">#</a> <strong>filter()</strong></h4> <p>如果符合条件，返回Optional对象本身，否则返回一个空的Optional对象</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// 源码： </span>
<span class="token comment">// Predicate&lt;T&gt; 接受一个输入参数，返回一个布尔值结果。</span>
<span class="token keyword">public</span> Optional<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">filter</span><span class="token punctuation">(</span>Predicate<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> T<span class="token operator">&gt;</span> predicate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 筛选年龄大于18的学生</span>
<span class="token keyword">public</span> static void <span class="token function">filterAge</span><span class="token punctuation">(</span>Student student<span class="token punctuation">)</span><span class="token punctuation">{</span>
    Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span>
  		<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span> u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">18</span><span class="token punctuation">)</span>
  		<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span>  System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;18888&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="map-映射成新的"><a href="#map-映射成新的" class="header-anchor">#</a> <strong>map() 映射成新的</strong></h4> <p>将Optional中的包装对象用Function函数进行运算，并包装成新的Optional对象</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token comment">// 源码， 为null则返回empty</span>
<span class="token comment">// Function: 一个入参，一个出参</span>
<span class="token keyword">public</span><span class="token operator">&lt;</span>U<span class="token operator">&gt;</span> Optional<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span>Function<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用map()计算学生的年龄，返回Optional&lt;Integer&gt;对象</span>
<span class="token comment">// 如果student为null, 返回empty</span>
<span class="token keyword">public</span> Optional<span class="token operator">&lt;</span>Integer<span class="token operator">&gt;</span> <span class="token function">getAge</span><span class="token punctuation">(</span>Student student<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="flatmap"><a href="#flatmap" class="header-anchor">#</a> <strong>flatMap()</strong></h4> <p>与map()差异：Function函数式接口的返回值类型为Optional&lt;U&gt;，作用就是这样flatMap()能将一个二维的Optional对象映射成一个一维的对象。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 源码</span>
<span class="token keyword">public</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Optional</span><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h3 id="结束"><a href="#结束" class="header-anchor">#</a> 结束</h3> <h4 id="get"><a href="#get" class="header-anchor">#</a> <strong>get()</strong></h4> <p>【慎用】如果value为null,也是会抛异常</p> <p><strong>Stack Overflow高赞回答:</strong></p> <blockquote><p>除非你能证明get()永远不会是null，否则<strong>永远不要调用它</strong>；相反，应该使用其他安全的方法，如orElse或ifPresent。<br>
回顾起来，我们应该把get命名为getOrElseThrowNoSuchElementException或其他能让人清楚这是一个<strong>非常危险的方法</strong>.（更新：Java 10有Optional.orElseThrow()，在语义上等同于get()，但其名称更为恰当。）</p></blockquote> <h4 id="orelse-orelseget-orelsethrow"><a href="#orelse-orelseget-orelsethrow" class="header-anchor">#</a> <strong>orElse/orElseGet/orElseThrow</strong></h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 用于兜底，如果上一步是null啥也没返回、啥也没处理，则用这个方法中的逻辑</span>
<span class="token class-name">Person</span> jack <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 源码：不为null则返回原值，为null则返回指定的值</span>
 <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token comment">// 用于兜底 </span>
<span class="token class-name">Person</span> jack <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Jack&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 源码：</span>
<span class="token comment">// Supplier: 无参数，返回一个结果</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token comment">// 用于遇到空时抛异常</span>
<span class="token class-name">Person</span> jack <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;指定外抛的异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>Optional.ofNullable(person).orElse(new Person(&quot;Jack&quot;, 20));</code><br>
在这个用法中，无论<code>person</code>是否为<code>null</code>，<code>new Person(&quot;Jack&quot;, 20)</code>都会被创建。这意味着即使<code>person</code>不为<code>null</code>，默认的<code>Person</code>对象也会被创建，然后被丢弃。这可能会造成不必要的对象创建和性能开销，尤其是如果创建默认对象的成本很高的话</li> <li><code>Optional.ofNullable(person).orElseGet(() -&gt; new Person(&quot;Jack&quot;, 20));</code><br>
在这个用法中，<code>new Person(&quot;Jack&quot;, 20)</code>只有在<code>person</code>确实为<code>null</code>时才会被创建。<code>orElseGet</code>方法接受一个<code>Supplier</code>函数式接口，这个接口的实现只有在需要的时候才会被调用。这样就避免了当<code>person</code>不为<code>null</code>时不必要的对象创建。</li></ul> <p>总结来说，<code>orElseGet</code>是惰性求值，它只有在需要的时候才会计算默认值，而<code>orElse</code>是即时求值，无论是否需要，默认值都会被创建。因此，在处理默认值的创建有显著开销或副作用时，推荐使用<code>orElseGet</code>来避免不必要的计算。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5fb9499f.js" defer></script><script src="/assets/js/2.9b59b4ff.js" defer></script><script src="/assets/js/1.96620eb7.js" defer></script><script src="/assets/js/29.66073005.js" defer></script>
  </body>
</html>
