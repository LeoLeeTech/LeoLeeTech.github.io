<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Build OpenJDK for macOS on Apple Silicon | 李吉磊 Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.5fb9499f.js" as="script"><link rel="preload" href="/assets/js/2.9b59b4ff.js" as="script"><link rel="preload" href="/assets/js/1.96620eb7.js" as="script"><link rel="preload" href="/assets/js/22.faf845ed.js" as="script"><link rel="prefetch" href="/assets/js/10.619c73b1.js"><link rel="prefetch" href="/assets/js/11.4fe3d8ed.js"><link rel="prefetch" href="/assets/js/12.431e0208.js"><link rel="prefetch" href="/assets/js/13.bbe468eb.js"><link rel="prefetch" href="/assets/js/14.12dedade.js"><link rel="prefetch" href="/assets/js/15.ce4589f9.js"><link rel="prefetch" href="/assets/js/16.f10ed1ca.js"><link rel="prefetch" href="/assets/js/17.9003e5f4.js"><link rel="prefetch" href="/assets/js/18.6a5c6852.js"><link rel="prefetch" href="/assets/js/19.4b690de6.js"><link rel="prefetch" href="/assets/js/20.3bada28f.js"><link rel="prefetch" href="/assets/js/21.21d2fb09.js"><link rel="prefetch" href="/assets/js/23.b8ebfab3.js"><link rel="prefetch" href="/assets/js/24.b27a1f24.js"><link rel="prefetch" href="/assets/js/25.24f97634.js"><link rel="prefetch" href="/assets/js/26.e2c8f48f.js"><link rel="prefetch" href="/assets/js/27.9f133172.js"><link rel="prefetch" href="/assets/js/28.75ed8791.js"><link rel="prefetch" href="/assets/js/29.66073005.js"><link rel="prefetch" href="/assets/js/3.c5ac82c9.js"><link rel="prefetch" href="/assets/js/30.a2505f42.js"><link rel="prefetch" href="/assets/js/4.2252019f.js"><link rel="prefetch" href="/assets/js/5.9c2dcfae.js"><link rel="prefetch" href="/assets/js/6.e16cc827.js"><link rel="prefetch" href="/assets/js/7.d07accda.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.58186997.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">李吉磊 Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/lijileiGood/lijileiGood.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/lijileiGood/lijileiGood.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Build OpenJDK for macOS on Apple Silicon</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/java/#为什么编译" class="sidebar-link">为什么编译</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/java/java/#编译过程及使用" class="sidebar-link">编译过程及使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/java/#去terminal中开始吧" class="sidebar-link">去Terminal中开始吧</a></li></ul></li><li><a href="/java/java/#如果不是指定环境会怎么样" class="sidebar-link">如果不是指定环境会怎么样</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Build OpenJDK for macOS on Apple Silicon.</p> <h2 id="为什么编译"><a href="#为什么编译" class="header-anchor">#</a> 为什么编译</h2> <p>之前听<a href="https://github.com/blindpirate" target="_blank" rel="noopener noreferrer">blindpirate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 大佬说过, 为了解决某个fastjson的bug编译了一下jdk让其报出更详细的异常信息.</p> <p>最近在读&lt;深入理解java虚拟机(第三版 周志明)&gt;, 第一章就是使用ubuntu 18 编译个openjdk12, 以供接下来学习使用. 想着不如就凑此机会用macos编译个jdk吧, 便开始了此次旅程.</p> <p>网络上没找到好的build openjdk的教程, 遂在此记录一下, 供朋友们少走弯路</p> <p>我的电脑配置:</p> <ul><li>型号: 2020款 13寸 macbookPro M1</li> <li>OS: Macos 12.6.4</li></ul> <h2 id="编译过程及使用"><a href="#编译过程及使用" class="header-anchor">#</a> 编译过程及使用</h2> <p>该<a href="https://gist.github.com/dgroomes/3af073b71c2c34581a155af9daa86564" target="_blank" rel="noopener noreferrer">链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>提供了主要的实操思路,感谢前辈!</p> <p>openJDK仓库中有一个相应版本的<a href="https://github.com/openjdk/jdk/blob/jdk-17%2B2/doc/building.md" target="_blank" rel="noopener noreferrer">build文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，介绍了build 的详细信息</p> <p>最重要的是这篇<a href="https://wiki.openjdk.org/display/Build/Supported+Build+Platforms" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 官方的build platforms wiki, 早看到他我能省一天的时间,也不至于走各种弯路. 进入链接后页面往下滑找到17&amp;18部分, 可以获得的信息是官方使用系统版本是<code>11.6.1</code>, Xcode版本是<code>13.1</code>.</p> <blockquote><p>官方文档的意义是:用指定的OS版本和Xcode版本一定可以成功</p> <p>你可以继续翻看该页面, 可以发现是从jdk17才支持 apple sillicon 的</p> <p>我就走了弯路, 用了非指定xcode, build了17以下的版本, 想看弯路的请直接看文章下半部分</p></blockquote> <p><img src="/assets/img/image-20230718165341632.042a8dfd.png" alt="image-20230718165341632"></p> <p><strong>环境准备</strong></p> <ul><li>OS: 与官方指定的最好,但现在还在用着11.X的系统的人不多了吧. 我的12.6.4编译成功啦,请放心使用.</li> <li>Xcode: AppStore只能安装最新版本的, 就算下载到历史版本也只能让电脑存在一个Xcode且安装特别慢. 在此我推荐<a href="https://www.xcodes.app/" target="_blank" rel="noopener noreferrer">Xcodes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 操作简单 安装快 可让同时存在多版本Xcode</li> <li>JDK17: 想编译X版本的jdk, 本地需要已安装X-1版本号的jdk. 我知道对某些朋友来说这不是常识,所以在此着重写出来</li></ul> <h3 id="去terminal中开始吧"><a href="#去terminal中开始吧" class="header-anchor">#</a> <strong>去Terminal中开始吧</strong></h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 下载jdk源码</span>
<span class="token function">git</span> clone https://github.com/openjdk/jdk.git

<span class="token builtin class-name">cd</span> jdk

<span class="token comment"># 切换到jdk18分支, 子版本可以认为是随便选的</span>
<span class="token function">git</span> checkout jdk-18+32

<span class="token comment"># 从此分支上切出来一个新分支, 以备如果编译失败可以重来</span>
<span class="token function">git</span> switch <span class="token parameter variable">-c</span> david-jdk-18

<span class="token comment"># 下方过程中会用到autoconf这个安装包, 提前安装</span>
brew <span class="token function">install</span> autoconf

<span class="token comment"># 自动配置, 根据当前电脑生成相应的配置文件</span>
<span class="token function">bash</span> configure

<span class="token comment"># (Optional) If you had previously cloned the code and executed a build you will want to first clean the project. Execute make clean.</span>
<span class="token comment"># 如果需要的话, 请clean</span>
<span class="token punctuation">[</span>可选<span class="token punctuation">]</span> <span class="token function">make</span> clean

<span class="token comment"># 开始编译! Wait for a long time</span>
<span class="token comment"># 成功后当前文件夹下会生成的build文件夹, build/macos/images/jdk下,再往下就是jdk包那一大套东西啦</span>
<span class="token function">make</span> images

<span class="token comment"># 验证是否成功, 就是调用一下java -version 命令</span>
build/macosx-x86_64-server-release/images/jdk/bin/java <span class="token parameter variable">-version</span>
</code></pre></div><p><strong>在idea中如何使用</strong></p> <p>指定项目的sdk为<code>build/macosx-x86_64-server-release/images/jdk</code>路径即可</p> <p><img src="/assets/img/image-20230509140241470.37846507.png" alt="image-20230509140241470"></p> <h2 id="如果不是指定环境会怎么样"><a href="#如果不是指定环境会怎么样" class="header-anchor">#</a> 如果不是指定环境会怎么样</h2> <p>没人教,没找到合适的教程, 就愣着头干, 装了弯路, 真羡慕看到此文章的你</p> <p>遇到的错误很多,但当时只记录了几个, 希望能帮助到有其他需求的你</p> <p><strong>编译工具不用官方指定版本</strong></p> <p>我用Xcode14.0版本弄了一天，试了jdk-17分支、jdk-18别的分支，都报错啦</p> <p><strong>电脑上也有多个Xcode版本的话</strong></p> <p>解决方法:提供一个有效的 SDK 路径</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">bash</span> configure
<span class="token comment"># 报错信息如下, 这个错误提示是由于 configure 脚本无法找到 Xcode</span>
 configure: error: No xcodebuild tool and no system framework headers found, use --with-sysroot or --with-sdk-name to provide a path to a valid SDK
 
 <span class="token comment"># --with-sysroot 参数接受一个Xcode的路径</span>
 <span class="token comment"># 我系统中安装的是Xcode-14.0.1.app，也可能是别的版本13.1.0</span>
<span class="token function">bash</span> configure --with-sysroot<span class="token operator">=</span>/Applications/Xcode-14.0.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk
</code></pre></div><p><strong>编译不支持的Apple sillicon的jdk版本</strong></p> <p>会编译失败,但请不要去解决, 因为解决完这一个还有后面一堆问题要解决,不要问我是怎么知道的</p> <p>在此记录一个<a href="https://github.com/openjdk/jdk/pull/5180/files?diff=unified&amp;w=0" target="_blank" rel="noopener noreferrer">pr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 给jdk修bug,编译过程中的错误，其实就是加了个空格</p> <blockquote><p><img src="/assets/img/image-20230509141501634.d241b83b.png" alt="image-20230509141501634"></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.5fb9499f.js" defer></script><script src="/assets/js/2.9b59b4ff.js" defer></script><script src="/assets/js/1.96620eb7.js" defer></script><script src="/assets/js/22.faf845ed.js" defer></script>
  </body>
</html>
